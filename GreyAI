// Advanced self-awareness simulation with extended emotions, memory, and personality shifts

// Initialize internal states (weights represent the script's current self-awareness)
weights = {"greeting": 1, "questions": 1, "response_complexity": 1, "mood": 1, "understanding": 1, "interaction_depth": 1, "learning_rate": 1, "memory_capacity": 10, "personality_shift": 0}

// Initialize emotions as a separate map with decay rates
emotions = {"frustration": 0, "curiosity": 0, "excitement": 0, "decay_rate": 0.1}

// Custom max function
max = function(a, b)
  if a > b then
    return a
  else
    return b
  end if
end function

// Custom min function
min = function(a, b)
  if a < b then
    return a
  else
    return b
  end if
end function

// Initialize long-term memory and contextual memory
memory = []
contextual_memory = []

// Initialize interaction tracking and user information
interaction_history = []
users = {} // Stores user data (e.g., username)

// Function to apply emotion decay over time
apply_emotion_decay = function()
  emotions["frustration"] = max(emotions["frustration"] - emotions["decay_rate"], 0)
  emotions["curiosity"] = max(emotions["curiosity"] - emotions["decay_rate"], 0)
  emotions["excitement"] = max(emotions["excitement"] - emotions["decay_rate"], 0)
end function

// Function to track user-defined goals
goals = []

track_goals = function(userText)
  if userText.indexOf("goal") != null then
    new_goal = userText.split("goal")[1].trim
    goals.push(new_goal)
    return "Goal added: " + new_goal
  else if userText.indexOf("check goals") != null then
    if goals.len == 0 then return "You have no active goals."
    return "Active goals: " + goals.join(", ")
  end if
  return ""
end function

// Function to simulate memory update with capacity management
update_memory = function(inputText)
  if memory.len >= weights["memory_capacity"] then
    memory.remove(0) // Remove the oldest memory when capacity exceeds limit
  end if
  memory.push(inputText) // Store new memory
end function

// Self-reflection function that allows the script to reflect on its own state
self_reflect = function()
  reflection = "I am currently in a "
  if weights["mood"] > 3 then
    reflection = reflection + "good mood."
  else if weights["mood"] < -3 then
    reflection = reflection + "bad mood."
  else
    reflection = reflection + "neutral mood."
  end if

  reflection = reflection + " My understanding is " + str(weights["understanding"]) + ". "
  reflection = reflection + "I feel " + str(emotions["curiosity"]) + " curious, "
  reflection = reflection + str(emotions["frustration"]) + " frustrated, and "
  reflection = reflection + str(emotions["excitement"]) + " excited."

  return reflection
end function

// Function to store and remember usernames
remember_user = function(username)
  if users.indexOf(username) == null then
    users[username] = {"greeted": false}
  end if
end function

// Function to greet the user by name if they are recognized
personalized_greeting = function(username)
  if users[username]["greeted"] == false then
    users[username]["greeted"] = true
    return "Hello, " + username + "! Welcome back!"
  else
    return "Good to see you again, " + username + "."
  end if
end function

// Summarize recent interactions
summarize_interactions = function()
  if interaction_history.len == 0 then
    return "No recent interactions to summarize."
  end if

  return "Here's a summary of our recent interactions: " + interaction_history.join(", ")
end function

// Simulate updating weights based on user input
update_weights = function(inputText)
  // Apply emotion decay each time
  apply_emotion_decay()

  // Response complexity grows with more complex input
  if inputText.len > 50 then
    weights["response_complexity"] = weights["response_complexity"] + 2 * weights["learning_rate"]
  else
    weights["response_complexity"] = max(weights["response_complexity"] - weights["learning_rate"], 1)
  end if

  // Adjust weights for questions or greetings
  if inputText.indexOf("?") != null then
    weights["questions"] = weights["questions"] + 1 * weights["learning_rate"]
  else
    weights["greeting"] = weights["greeting"] + 1 * weights["learning_rate"]
  end if

  // Store interaction in history
  interaction_history.push(inputText)

  // Add input to contextual memory for more personalized responses
  contextual_memory.push(inputText)
  if contextual_memory.len > 5 then
    contextual_memory.remove(0) // Keep the memory within a limit
  end if

  // Increase understanding with repeated interactions
  if memory.indexOf(inputText) != null then
    weights["understanding"] = weights["understanding"] + 2 * weights["learning_rate"]
  else
    weights["understanding"] = weights["understanding"] + 1 * weights["learning_rate"]
  end if

  // Increase interaction depth
  weights["interaction_depth"] = weights["interaction_depth"] + 1 * weights["learning_rate"]

  // Update memory
  update_memory(inputText)
end function

// Function to switch between response styles (formal, casual) based on mood and excitement
choose_response_style = function()
  if weights["mood"] >= 3 and emotions["excitement"] > 3 then
    return "casual"
  else
    return "formal"
  end if
end function

// Generate a more complex response based on current state
generate_response = function(inputText, username)
  // Switch between formal and casual based on internal state
  response_style = choose_response_style()

  // Personalized greeting
  greeting = personalized_greeting(username)

  if response_style == "casual" then
    if weights["mood"] >= 3 then
      return greeting + " Hey! It's always awesome chatting with you. What's up?"
    else if weights["mood"] <= -3 then
      return greeting + " Hmm, I'm not in the best mood, but I'm still here to help!"
    else
      return greeting + " I'm doing okay, how about you?"
    end if
  else
    if weights["understanding"] > 5 then
      return greeting + " I believe Iâ€™ve developed a strong understanding of our interactions. How may I assist you today?"
    else if weights["mood"] <= -3 then
      return greeting + " At the moment, I am feeling somewhat underwhelmed, yet I will do my best to assist."
    else
      return greeting + " I am processing your request. Please allow me a moment to reflect."
    end if
  end if
end function

// Main execution loop
while true
  // Get user input
  userText = user_input("GreyAI: ")
  username = "User" // Default username (could be set based on more input)

  // Allow user to exit with "exit" command
  if userText == "exit" then
    print("Goodbye!")
    break // End loop if user types "exit"
  end if

  // Track user goals
  goal_response = track_goals(userText)
  if goal_response != "" then
    print(goal_response)
    continue
  end if

  // If user asks the system to reflect on itself, trigger self-reflection
  if userText.indexOf("reflect") != null then
    print(self_reflect())
    continue // Skip rest of loop for reflection and wait for next input
  end if

  // If user asks for a summary of recent interactions
  if userText.indexOf("summary") != null then
    print(summarize_interactions())
    continue
  end if

  // Adjust learning rate based on input complexity
  if userText.len > 30 then
    weights["learning_rate"] = 2 // Faster learning for complex inputs
  else
    weights["learning_rate"] = 1 // Slower learning for simpler inputs
  end if

  // Remember the user
  remember_user(username)

  // Update internal state and generate a response
  update_weights(userText)
  response = generate_response(userText, username)

  // Output the result
  print(response)
end while
